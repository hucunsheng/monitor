<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>
    <script src="./echarts.js"></script>

    <script type="text/javascript" src="./vue.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./iview.css">
    <script type="text/javascript" src="./iview.min.js"></script>
    <link rel="stylesheet" href="./jquery-ui.css">
    <script src="./jquery-1.9.1.js"></script>
    <script src="./jquery-ui.js"></script>

 <!--日期时间控件-->

    <link href="jQuery-Timepicker-Addon/jquery-ui-timepicker-addon.css" type="text/css" />
    <link href="jQuery-Timepicker-Addon/demos.css" rel="stylesheet" type="text/css" />

    <script src="jQuery-Timepicker-Addon/jquery-ui-timepicker-addon.js" type="text/javascript"></script>

    <!--中文-->
    <script src="js/jquery.ui.datepicker-zh-CN.js.js" type="text/javascript" charset="gb2312"></script>
    <script src="js/jquery-ui-timepicker-zh-CN.js" type="text/javascript"></script>


</head>
<body>
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div id="app">
    <select id="selectMonitor" v-model="couponSelected">
        <option v-for="option in options" :value="option.MONITOR_CON_PARA_ID">
            {{ option.PARA_SERVICENAME }}
        </option>
    </select>
    <!--<span>Selected: {{ couponSelected }}</span>-->

        <label style="margin-left: 100px;" for="from">从</label>
            <input type="text" id="from" name="from">
            <label for="to">到</label>
            <input type="text" id="to" name="to">

            <input type="button" id="query" onclick="init();" style="margin-left: 200px;width:100px;height: 20px;" value="查询">

</div>
<div id="main" style="height:400px"></div>
<!-- ECharts单文件引入 -->

<script type="text/javascript">


</script>
<script type="text/javascript">
    $(function() {


        $( "#from" ).datetimepicker({
            defaultDate: "-1w",
            changeMonth: true,
            numberOfMonths: 1,
            dateFormat: 'yy-mm-dd',
            timeFormat: 'HH:mm:ss',
            onClose: function( selectedDate ) {
                $( "#to" ).datepicker( "option", "minDate", selectedDate );
            }
        });

        $( "#to" ).datetimepicker({
            defaultDate: "-1w",
            changeMonth: true,
            numberOfMonths: 1,
            dateFormat: 'yy-mm-dd',
            timeFormat: 'HH:mm:ss',
            onClose: function( selectedDate ) {
                $( "#from" ).datepicker( "option", "maxDate", selectedDate );
            }
        });

    });
    var app = new Vue({
        el: '#app',
        data: {
            //selected: 'A',
            options: [
                { text: 'One', value: 'A' },
                { text: 'Two', value: 'B' },
                { text: 'Three', value: 'C' }
            ],
            couponSelected: ''
        }
    })

    $.ajax({
        url:"/monitor/getMonitors",
        type:"get",
        data: {
            //from: fromval,
            //to: toval,
            //pageIndex :1
        },
        dataType:"json",
        success:function(response){
            var selectList = response.selectList;
            app.$data.options=selectList;
            app.$data.couponSelected=selectList[0].MONITOR_CON_PARA_ID;
        },
        error: function(XMLHttpRequest, textStatus, errorThrown){
        },
        beforeSend:function(XMLHttpRequest){
        },
        complete:function(XMLHttpRequest,textStatus){
        }
    })

    function init() {
        // 基于准备好的dom，初始化echarts图表
        var myChart = echarts.init(document.getElementById('main'));
        var fromval = $( "#from" ).val();
        var toval = $( "#to" ).val();

        $.ajax({
            url: "/monitor/getEcharts",
            type: "post",
            data: {
                from: fromval,
                to: toval,
                monitorId :app.$data.couponSelected
            },
            dataType: "json",
            success: function (response) {
                $( "#from" ).val(response.from);
                $( "#to" ).val(response.to);
                var xAxisList = response.xAxisList;
                var seriesList = response.seriesList;
                var option = {
                    title : {
                        text: $("#selectMonitor option:selected").text()
//                        subtext: '纯属虚构'
                    },
                    tooltip: {
                        show: true
                    },
                    legend: {
                        data: ['调用量']
                    },
                    xAxis: [
                        {
                            type: 'category',
                            data: xAxisList
                        }
                    ],
                    yAxis: [
                        {
                            type: 'value'
                        }
                    ],
                    series: [
                        {
                            "name": "调用量",
                            "type": "bar",
                            "data": seriesList
                        }
                    ]
                };


                // 为echarts对象加载数据
                myChart.setOption(option);
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
            },
            beforeSend: function (XMLHttpRequest) {
            },
            complete: function (XMLHttpRequest, textStatus) {
            }
        })

    }
    init();
</script>
</body>